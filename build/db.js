/*!
(C) Andrea Giammarchi, @WebReflection - Mit Style License
*/
"db" in this||(function(L){if(typeof __dirname!="undefined"){L.create=j;L=global}else{L.db={create:j}}function j(V,W,X){if(X==z){X=W;W=1<<20}return new C(V,W,X)}function y(){return"".concat.apply("",arguments)}function n(){console.log("[ERROR]",arguments)}var e=j.bind||function(V){var X=this,W=[].slice.call(arguments,1);return function(){return X.apply(V,W.concat.apply(W,arguments))}},p=[].indexOf||function(W){for(var V=this.length;V--&&this[V]!==W;){}return V},K=L.setTimeout,f="ndexedDB",M="openDatabase",I="executeSql",B="transaction",P="readTransaction",A="localStorage",r="prototype",t="asynchronous_storage",H="db_key",g="db_value",F="_keys",w="length",h="key",Q="getItem",T="setItem",S="removeItem",l="clear",O=L["i"+f]||L["webkitI"+f]||L["mozI"+f]||L["msI"+f],z=null,u=L.Math.max,C,U,a,s,J,c,R,N,E,x,D,k,m,o,v;if(M in L){C=function C(V,W,X){this.name=V;this.type="WebSQL";(this._db=L[M](V,"1.0","",W))[B](e.call(a,this,X))};a=function(W,V){V[I](y("CREATE TABLE IF NOT EXISTS ",t," ","(",g," TEXT NOT NULL,",H," TEXT NOT NULL PRIMARY KEY",")"),[],e.call(s,this,W),n)};s=function(V){this._db[P](e.call(J,this,V))};J=function(W,V){V[I](y("SELECT ",H," AS k FROM ",t),[],e.call(c,this,W),n)};c=function(aa,X,V){for(var Y=this[F]=[],Z=V.rows,W=Z[w];W--;Y[W]=Z.item(W).k){}aa.call(this,this,this[w]=Y[w])};D=function(V,W,Y,X){if(!X){this[w]=this[F].push(V)}Y.call(this,W,V,this)};R=function(W,Y,aa,X,Z,V){V[I](Z?y("UPDATE ",t," SET ",g," = ? WHERE ",H," = ?"):y("INSERT INTO ",t," VALUES (?, ?)"),[Y,W],e.call(D,this,W,Y,aa,Z),X)};k=function(X,Z,aa,Y,W,V){this._db[B](e.call(R,this,X,Z,aa,Y,!!V.rows.length))};N=function(W,Z,aa,Y,X,V){V[I](y("SELECT ",g," AS v FROM ",t," WHERE ",H," = ?"),[W],e.call(X,this,W,Z,aa,Y),Y)};m=function(X,aa,ab,Z,W,V){var Y=V.rows;ab.call(this,Y[w]?Y.item(0).v:aa,X,this)};o=function(V){V.call(this,this,this[F][w]=this[w]=0)};E=function(X,W,V){V[I](y("DELETE FROM ",t),[],e.call(o,this,X),W)};v=function(Y,Z,X,V){if(this[w]=this[w]-u(V.rowsAffected?1:0)){var W=p.call(this[F],Y);if(~W){this[F].splice(W,1)}}else{this[F][w]=0}Z.call(this,Y,this)};x=function(W,Y,X,V){V[I](y("DELETE FROM ",t," WHERE ",H," = ?"),[W],e.call(v,this,W,Y),X)};U=C[r];U[h]=function q(V){return this[F][V]};U[S]=function i(V,X,W){this._db[B](e.call(x,this,V,X||n,e.call(W||n,this)))};U[l]=function G(W,V){this._db[B](e.call(E,this,W||n,e.call(V||n,this)))};U[Q]=function b(V,X,W){this._db[P](e.call(N,this,V,null,X||n,e.call(W||n,this),m))};U[T]=function d(V,X,Y,W){this._db[P](e.call(N,this,V,X,Y||n,e.call(W||n,this),k))}}else{if(A in L){C=function C(W,X,Y){var V=this;V.name=W;V.type=A;V._db=L[A];V._prefix=t+"\x00"+V.name+"\x00";V[F]=[];c.call(V);K(e.call(Y,V,V,V[w]),0)};c=function(){for(var X=this,ac=X._prefix,ab=X[F],W=X._db,V=0,Z=0,aa=W[w],Y;Z<aa;++Z){if(!(Y=W[h](Z)||"").indexOf(ac)){ab[V++]=Y}}X[w]=V};x=function(Y,ab,aa){var W=this,Z=W[F],V=W._prefix+Y,X=p.call(Z,V);if(~X){Z.splice(X,1);W._db[S](V)}ab.call(W,Y,W)};E=function(aa,Z){for(var V=this,Y=V[F],W=0,X=Y[w];W<X;++W){V._db[S](Y[W])}aa.call(V,V,V[w]=V[F][w]=0)};N=function(W,Y,X){var V=this;Y.call(V,V._db[Q](V._prefix+W),W,V)};R=function(X,Z,ab,Y){var W=this,V=W._prefix+X;try{W._db[T](V,Z);if(!~p.call(W[F],V)){W[w]=W[F].push(V)}ab.call(W,Z,X,W)}catch(aa){Y.call(W,aa)}};s=function(V){if(V._db[w]<V[F][w]){throw"unobtrusive attempt to manipulate the localStorage"}return V};U=C[r];U[h]=function q(W){var V=s(this)[F][W];return V==z?V:V.slice(this._prefix[w])};U[S]=function i(V,X,W){K(e.call(x,s(this),V,X||n,W||n),0)};U[l]=function G(W,V){K(e.call(E,s(this),W||n,V||n),0)};U[Q]=function b(V,X,W){K(e.call(N,s(this),V,X||n,W||n),0)};U[T]=function d(V,X,Y,W){K(e.call(R,s(this),V,X,Y||n,W||n),0)}}else{C=function C(W,X,Y){var V=this;V.name=W;V.type="cookie";V._db=L.document;V._prefix=t+"\x00"+V.name+"\x00";V[F]=[];c.call(V);K(e.call(Y,V,V,V[w]),0)};c=function(){for(var ad=this,ae=ad._db.cookie.split(";"),aa=escape(ad._prefix),ac=ad[F],X=0,Z=0,V=ae[w],W,Y,ab;Z<V;++Z){W=ae[Z];if(!~W.indexOf(aa)){ac[X++]=unescape(W.slice(0,W.indexOf("=")))}}ad[w]=X};s=function(V){if(V._db.cookie[w]<V[F].join(";")[w]){throw"unobtrusive attempt to manipulate cookies"}return V};x=function(Y,ac,aa){var W=this,Z=W[F],ab=W._prefix+Y,V=escape(ab),X=W._db.cookie.indexOf(V);if(~X){W._db.cookie=V+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT";X=p.call(Z,ab);if(~X){Z.splice(X,1);W[w]=Z.length}}ac.call(W,Y,W)};E=function(aa,Z){for(var V=this,Y=V._prefix,X=V[F],W=X.length;W--;x.call(V,X[W].slice(Y.length),n,n)){}aa.call(V,V,V[w]=V[F][w]=0)};N=function(Y,aa,X){var ab=this,ac=ab._db.cookie,W=escape(ab._prefix+Y),Z=ac.indexOf(W+"=")+W[w],ad=z,V;if(++Z>W[w]){V=ac.indexOf(";",Z);V<0&&(V=ac[w]);ad=unescape(ac.substr(Z,V-Z))}aa.call(ab,ad,Y,ab)};R=function(Y,ab,ac,aa){var X=this,W=X._db.cookie,V=X._prefix+Y,Z=escape(V);if(!~W.indexOf(Z)){X[w]=X[F].push(V)}X._db.cookie=y(Z,"=",escape(ab),";","expires=",(new Date(+new Date+365*60*60*24)).toGMTString());ac.call(X,ab,Y,X)};U=C[r];U[h]=function q(W){var V=s(this)[F][W];return V==z?V:V.slice(this._prefix[w])};U[S]=function i(V,X,W){K(e.call(x,s(this),V,X||n,W||n),0)};U[l]=function G(W,V){K(e.call(E,s(this),W||n,V||n),0)};U[Q]=function b(V,X,W){K(e.call(N,s(this),V,X||n,W||n),0)};U[T]=function d(V,X,Y,W){K(e.call(R,s(this),V,X,Y||n,W||n),0)}}}}(this));