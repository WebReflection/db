/*!
(C) Andrea Giammarchi, @WebReflection - Mit Style License
*/
"db" in this||(function(M){if(typeof __dirname!="undefined"){M.create=j;M=global}else{M.db={create:j}}function j(W,X,Y){if(Y==A){Y=X;X=1<<20}return new D(W,X,Y)}function z(){return"".concat.apply("",arguments)}function n(){console.log("[ERROR]",arguments)}var e=j.bind||function(W){var Y=this,X=[].slice.call(arguments,1);return function(){return Y.apply(W,X.concat.apply(X,arguments))}},p=[].indexOf||function(X){for(var W=this.length;W--&&this[W]!==X;){}return W},L=M.setTimeout,y="\x00",f="ndexedDB",N="openDatabase",J="executeSql",C="transaction",Q="readTransaction",B="localStorage",r="prototype",t="asynchronous_storage",I="db_key",g="db_value",G="_keys",w="length",h="key",R="getItem",U="setItem",T="removeItem",l="clear",P=M["i"+f]||M["webkitI"+f]||M["mozI"+f]||M["msI"+f],A=null,u=M.Math.max,D,V,a,s,K,c,S,O,F,x,E,k,m,o,v;if(N in M){D=function D(W,X,Y){this.name=W;this.type="WebSQL";(this._db=M[N](W,"1.0","",X))[C](e.call(a,this,Y))};a=function(X,W){W[J](z("CREATE TABLE IF NOT EXISTS ",t," ","(",g," TEXT NOT NULL,",I," TEXT NOT NULL PRIMARY KEY",")"),[],e.call(s,this,X),n)};s=function(W){this._db[Q](e.call(K,this,W))};K=function(X,W){W[J](z("SELECT ",I," AS k FROM ",t),[],e.call(c,this,X),n)};c=function(ab,Y,W){for(var Z=this[G]=[],aa=W.rows,X=aa[w];X--;Z[X]=aa.item(X).k){}ab.call(this,this,this[w]=Z[w])};E=function(W,X,Z,Y){if(!Y){this[w]=this[G].push(W)}Z.call(this,X,W,this)};S=function(X,Z,ab,Y,aa,W){W[J](aa?z("UPDATE ",t," SET ",g," = ? WHERE ",I," = ?"):z("INSERT INTO ",t," VALUES (?, ?)"),[Z,X],e.call(E,this,X,Z,ab,aa),Y)};k=function(Y,aa,ab,Z,X,W){this._db[C](e.call(S,this,Y,aa,ab,Z,!!W.rows.length))};O=function(X,aa,ab,Z,Y,W){W[J](z("SELECT ",g," AS v FROM ",t," WHERE ",I," = ?"),[X],e.call(Y,this,X,aa,ab,Z),Z)};m=function(Y,ab,ac,aa,X,W){var Z=W.rows;ac.call(this,Z[w]?Z.item(0).v:ab,Y,this)};o=function(W){W.call(this,this,this[G][w]=this[w]=0)};F=function(Y,X,W){W[J](z("DELETE FROM ",t),[],e.call(o,this,Y),X)};v=function(Z,aa,Y,W){if(this[w]=this[w]-u(W.rowsAffected?1:0)){var X=p.call(this[G],Z);if(~X){this[G].splice(X,1)}}else{this[G][w]=0}aa.call(this,Z,this)};x=function(X,Z,Y,W){W[J](z("DELETE FROM ",t," WHERE ",I," = ?"),[X],e.call(v,this,X,Z),Y)};V=D[r];V[h]=function q(W){return this[G][W]};V[T]=function i(W,Y,X){this._db[C](e.call(x,this,W,Y||n,e.call(X||n,this)))};V[l]=function H(X,W){this._db[C](e.call(F,this,X||n,e.call(W||n,this)))};V[R]=function b(W,Y,X){this._db[Q](e.call(O,this,W,null,Y||n,e.call(X||n,this),m))};V[U]=function d(W,Y,Z,X){this._db[Q](e.call(O,this,W,Y,Z||n,e.call(X||n,this),k))}}else{if(B in M){D=function D(X,Y,Z){var W=this;W.name=X;W.type=B;W._db=M[B];W._prefix=escape(t+y+W.name+y);W[G]=[];c.call(W);L(e.call(Z,W,W,W[w]),0)};c=function(){for(var Y=this,ad=Y._prefix,ac=Y[G],X=Y._db,W=0,aa=0,ab=X[w],Z;aa<ab;++aa){if(!(Z=X[h](aa)||"").indexOf(ad)){ac[W++]=Z}}Y[w]=W};x=function(Z,ac,ab){var X=this,aa=X[G],W=X._prefix+Z,Y=p.call(aa,W);if(~Y){aa.splice(Y,1);X._db[T](W)}ac.call(X,Z,X)};F=function(ab,aa){for(var W=this,Z=W[G],X=0,Y=Z[w];X<Y;++X){W._db[T](Z[X])}ab.call(W,W,W[w]=W[G][w]=0)};O=function(X,Z,Y){var W=this;Z.call(W,W._db[R](W._prefix+X),X,W)};S=function(Y,aa,ac,Z){var X=this,W=X._prefix+Y;try{X._db[U](W,aa);if(!~p.call(X[G],W)){X[w]=X[G].push(W)}ac.call(X,aa,Y,X)}catch(ab){Z.call(X,ab)}};s=function(W){if(W._db[w]<W[G][w]){throw"unobtrusive attempt to manipulate the localStorage"}return W};V=D[r];V[h]=function q(X){var W=s(this)[G][X];return W==A?W:W.slice(this._prefix[w])};V[T]=function i(W,Y,X){L(e.call(x,s(this),W,Y||n,X||n),0)};V[l]=function H(X,W){L(e.call(F,s(this),X||n,W||n),0)};V[R]=function b(W,Y,X){L(e.call(O,s(this),W,Y||n,X||n),0)};V[U]=function d(W,Y,Z,X){L(e.call(S,s(this),W,Y,Z||n,X||n),0)}}else{D=function D(X,Y,Z){var W=this;W.name=X;W.type="cookie";W._db=M.document;W._prefix=t+y+W.name+y;W[G]=[];c.call(W);L(e.call(Z,W,W,W[w]),0)};c=function(){for(var ae=this,af=ae._db.cookie.split(";"),ab=escape(ae._prefix),ad=ae[G],Y=0,aa=0,W=af[w],X,Z,ac;aa<W;++aa){X=af[aa];if(!~X.indexOf(ab)){ad[Y++]=unescape(X.slice(0,X.indexOf("=")))}}ae[w]=Y};s=function(W){if(W._db.cookie[w]<W[G].join(";")[w]){throw"unobtrusive attempt to manipulate cookies"}return W};x=function(Z,ad,ab){var X=this,aa=X[G],ac=X._prefix+Z,W=escape(ac),Y=X._db.cookie.indexOf(W);if(~Y){X._db.cookie=W+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT";Y=p.call(aa,ac);if(~Y){aa.splice(Y,1);X[w]=aa.length}}ad.call(X,Z,X)};F=function(ab,aa){for(var W=this,Z=W._prefix,Y=W[G],X=Y.length;X--;x.call(W,Y[X].slice(Z.length),n,n)){}ab.call(W,W,W[w]=W[G][w]=0)};O=function(Z,ab,Y){var ac=this,ad=ac._db.cookie,X=escape(ac._prefix+Z),aa=ad.indexOf(X+"=")+X[w],ae=A,W;if(++aa>X[w]){W=ad.indexOf(";",aa);W<0&&(W=ad[w]);ae=unescape(ad.substr(aa,W-aa))}ab.call(ac,ae,Z,ac)};S=function(Z,ac,ad,ab){var Y=this,X=Y._db.cookie,W=Y._prefix+Z,aa=escape(W);if(!~X.indexOf(aa)){Y[w]=Y[G].push(W)}Y._db.cookie=z(aa,"=",escape(ac),";","expires=",(new Date(+new Date+365*60*60*24)).toGMTString());ad.call(Y,ac,Z,Y)};V=D[r];V[h]=function q(X){var W=s(this)[G][X];return W==A?W:W.slice(this._prefix[w])};V[T]=function i(W,Y,X){L(e.call(x,s(this),W,Y||n,X||n),0)};V[l]=function H(X,W){L(e.call(F,s(this),X||n,W||n),0)};V[R]=function b(W,Y,X){L(e.call(O,s(this),W,Y||n,X||n),0)};V[U]=function d(W,Y,Z,X){L(e.call(S,s(this),W,Y,Z||n,X||n),0)}}}}(this));